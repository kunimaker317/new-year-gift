<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Stars Giveaway</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary: #e0a509;
            --accent: #ff0055;
            --bg-grad-start: #1c1038;
            --bg-grad-end: #0a0514;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-grad-start), var(--bg-grad-end));
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- UI ELEMENTS --- */
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .progress-container {
            position: absolute;
            top: 40px;
            width: 80%;
            max-width: 300px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            opacity: 0; /* –°–∫—Ä—ã—Ç –ø–æ–∫–∞ –Ω–µ –Ω–∞–∂–º—É—Ç –ø–µ—Ä–≤—ã–π —Ä–∞–∑ */
            transition: opacity 0.3s;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ffaa00, #ffea00);
            box-shadow: 0 0 10px #ffaa00;
            transition: width 0.1s linear;
        }

        /* –¢–µ–∫—Å—Ç—ã */
        .title {
            position: absolute;
            top: 60px;
            font-size: 16px;
            font-weight: 500;
            color: rgba(255,255,255,0.6);
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* –°—Ü–µ–Ω–∞ 1: –ö–ª–∏–∫–µ—Ä (–ó–≤–µ–∑–¥–∞) */
        #stage-clicker {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .main-star-wrapper {
            position: relative;
            width: 200px;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }

        .main-star {
            font-size: 120px;
            filter: drop-shadow(0 0 40px rgba(224, 165, 9, 0.4));
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2;
        }

        .click-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(255, 215, 0, 0.3);
            transform: scale(0.8);
            opacity: 0;
        }

        .tap-hint {
            margin-top: 30px;
            font-size: 14px;
            opacity: 0.5;
            animation: pulseText 2s infinite;
        }

        /* –°—Ü–µ–Ω–∞ 2: –†—É–ª–µ—Ç–∫–∞ (–ü–æ–¥–∞—Ä–∫–∏) */
        #stage-roulette {
            display: none; /* Flex –ø—Ä–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ */
            width: 100%;
            height: 100%;
            justify-content: center;
            align-items: center;
            perspective: 800px; /* –î–ª—è 3D –≤—Ä–∞—â–µ–Ω–∏—è */
            z-index: 10;
        }

        .gift-container {
            position: absolute;
            width: 90px;
            height: 90px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 70px;
            /* –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –≤—Å–µ –≤ —Ü–µ–Ω—Ç—Ä–µ, –Ω–µ–≤–∏–¥–∏–º—ã–µ */
            opacity: 0; 
            transform: scale(0);
            cursor: pointer;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
        }
        
        /* –°–≤–µ—á–µ–Ω–∏–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ—Ä–æ–±–æ–∫ */
        .gift-container.active {
            animation: float 3s ease-in-out infinite;
        }
        .gift-container.active::after {
            content: '';
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 15px;
            background: radial-gradient(ellipse, rgba(255,255,255,0.2), transparent 70%);
            z-index: -1;
        }

        /* –°—Ü–µ–Ω–∞ 3: –†–µ–∑—É–ª—å—Ç–∞—Ç */
        #stage-result {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            z-index: 100;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.5s;
        }

        .result-card {
            background: rgba(30, 30, 40, 0.6);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 170, 0, 0.15);
            transform: scale(0.8);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        /* –õ—É—á–∏ —Å–≤–µ—Ç–∞ –Ω–∞ —Ñ–æ–Ω–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .sunburst {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 500px;
            height: 500px;
            background: repeating-conic-gradient(
                from 0deg,
                rgba(255, 215, 0, 0.05) 0deg 20deg,
                transparent 20deg 40deg
            );
            transform: translate(-50%, -50%);
            animation: rotateSun 20s linear infinite;
            z-index: -1;
        }

        .btn-main {
            background: linear-gradient(90deg, #ff9a00, #e0a509);
            border: none;
            padding: 16px 40px;
            border-radius: 16px;
            color: #fff;
            font-weight: 700;
            font-size: 18px;
            margin-top: 20px;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(255, 154, 0, 0.4);
        }

        /* --- ANIMATIONS --- */

        /* –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è */
        .clicked {
            transform: scale(0.9) !important;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–ª—å—Ü–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ */
        @keyframes expandRing {
            0% { transform: scale(0.8); opacity: 1; border-width: 4px;}
            100% { transform: scale(1.5); opacity: 0; border-width: 0px;}
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–æ—Ä–æ–±–æ–∫ (–í—Ä–∞—â–µ–Ω–∏–µ + –¥–≤–∏–∂–µ–Ω–∏–µ) */
        @keyframes spinOutLeft {
            0% { opacity: 0; transform: translateX(0) rotateY(0deg) scale(0); }
            100% { opacity: 1; transform: translateX(-100px) rotateY(-360deg) scale(1); }
        }
        @keyframes spinOutRight {
            0% { opacity: 0; transform: translateX(0) rotateY(0deg) scale(0); }
            100% { opacity: 1; transform: translateX(100px) rotateY(360deg) scale(1); }
        }
        @keyframes spinOutCenter {
            0% { opacity: 0; transform: translateY(0) rotateX(0deg) scale(0); }
            100% { opacity: 1; transform: translateY(0) rotateX(360deg) scale(1); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) translateX(var(--offset)); }
            50% { transform: translateY(-15px) translateX(var(--offset)); }
        }

        @keyframes rotateSun {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        @keyframes pulseText {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Canvas –¥–ª—è —á–∞—Å—Ç–∏—Ü */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 50;
        }
    </style>
</head>
<body>

    <div class="progress-container">
        <div class="progress-bar" id="progress"></div>
    </div>
    <div class="title" id="status-text">–ó–∞—Ä—è–¥–∏ —ç–Ω–µ—Ä–≥–∏—é</div>

    <canvas id="canvas"></canvas>

    <!-- –°–¶–ï–ù–ê 1: –ö–õ–ò–ö–ï–† -->
    <div id="stage-clicker">
        <div class="main-star-wrapper" id="click-btn">
            <div class="click-ring"></div>
            <div class="main-star">‚≠êÔ∏è</div>
        </div>
        <div class="tap-hint">–¢–∞–ø–∞–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–∫–∏</div>
    </div>

    <!-- –°–¶–ï–ù–ê 2: –†–£–õ–ï–¢–ö–ê -->
    <div id="stage-roulette">
        <!-- –ü–æ–¥–∞—Ä–∫–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        <div class="gift-container" id="gift-1">üéÅ</div>
        <div class="gift-container" id="gift-2">üéÅ</div>
        <div class="gift-container" id="gift-3">üéÅ</div>
    </div>

    <!-- –°–¶–ï–ù–ê 3: –†–ï–ó–£–õ–¨–¢–ê–¢ -->
    <div id="stage-result">
        <div class="result-card">
            <div class="sunburst"></div>
            <div style="font-size: 80px; margin-bottom: 10px;">‚≠êÔ∏è</div>
            <h2 style="margin: 0; font-size: 32px; color: #ffca28;">5000</h2>
            <p style="margin: 5px 0 20px; color: #ddd;">Telegram Stars</p>
            <button class="btn-main" onclick="tg.close()">–ó–ê–ë–†–ê–¢–¨</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
        const CLICKS_TO_WIN = 10; // –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –Ω—É–∂–Ω–æ –Ω–∞–∂–∞—Ç—å
        let clicks = 0;
        let isRouletteStarted = false;

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const progressBar = document.getElementById('progress');
        const progressCont = document.querySelector('.progress-container');
        const clickerStage = document.getElementById('stage-clicker');
        const rouletteStage = document.getElementById('stage-roulette');
        const resultStage = document.getElementById('stage-result');
        const resultCard = document.querySelector('.result-card');
        const clickBtn = document.getElementById('click-btn');
        const starEl = document.querySelector('.main-star');
        const statusText = document.getElementById('status-text');

        // --- –õ–û–ì–ò–ö–ê –ö–õ–ò–ö–ï–†–ê ---
        clickBtn.addEventListener('click', (e) => {
            if (isRouletteStarted) return;

            // –í–∏–∑—É–∞–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∫–ª–∏–∫–∞
            tg.HapticFeedback.impactOccurred('light');
            
            // –ê–Ω–∏–º–∞—Ü–∏—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∑–≤–µ–∑–¥—ã
            starEl.classList.add('clicked');
            setTimeout(() => starEl.classList.remove('clicked'), 100);

            // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–ª—å—Ü–∞
            const ring = document.createElement('div');
            ring.classList.add('click-ring');
            ring.style.animation = 'expandRing 0.4s ease-out forwards';
            clickBtn.appendChild(ring);
            setTimeout(() => ring.remove(), 400);

            // –ß–∞—Å—Ç–∏—Ü—ã
            createParticles(e.clientX, e.clientY, 5);

            // –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            clicks++;
            progressCont.style.opacity = '1';
            const progressPercent = (clicks / CLICKS_TO_WIN) * 100;
            progressBar.style.width = `${progressPercent}%`;

            if (clicks >= CLICKS_TO_WIN) {
                startRoulette();
            }
        });

        // --- –õ–û–ì–ò–ö–ê –†–£–õ–ï–¢–ö–ò ---
        function startRoulette() {
            isRouletteStarted = true;
            statusText.innerText = "–í—ã–±–∏—Ä–∞–π –ø–æ–¥–∞—Ä–æ–∫";
            statusText.style.opacity = '0'; // –°–∫—Ä–æ–µ–º –Ω–∞ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏

            // –ü—Ä—è—á–µ–º –∫–ª–∏–∫–µ—Ä
            clickerStage.style.transition = 'opacity 0.3s, transform 0.3s';
            clickerStage.style.opacity = '0';
            clickerStage.style.transform = 'scale(1.5)';
            
            setTimeout(() => {
                clickerStage.style.display = 'none';
                rouletteStage.style.display = 'flex';
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ–¥–∞—Ä–∫–æ–≤
                animateGiftsEntry();
            }, 300);
        }

        function animateGiftsEntry() {
            const g1 = document.getElementById('gift-1');
            const g2 = document.getElementById('gift-2');
            const g3 = document.getElementById('gift-3');

            // –ù–∞–∑–Ω–∞—á–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏–∏ –≤—ã–ª–µ—Ç–∞ (Left, Center, Right)
            // 0.8s - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Ä–∞—â–µ–Ω–∏—è
            g1.style.animation = 'spinOutLeft 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards';
            g2.style.animation = 'spinOutCenter 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards';
            g3.style.animation = 'spinOutRight 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards';

            // –ö–æ–≥–¥–∞ –æ–Ω–∏ "–ø—Ä–∏–∑–µ–º–ª–∏–ª–∏—Å—å"
            setTimeout(() => {
                tg.HapticFeedback.notificationOccurred('success'); // –í–∏–±—Ä–∞—Ü–∏—è "—É—Å–ø–µ—Ö" –ø—Ä–∏ –ø—Ä–∏–∑–µ–º–ª–µ–Ω–∏–∏
                
                // –î–µ–ª–∞–µ–º –∏—Ö "–ø–ª–∞–≤–∞—é—â–∏–º–∏" (breathing) –∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏
                [g1, g2, g3].forEach((el, index) => {
                    el.style.animation = 'none'; // —Å–±—Ä–æ—Å –≤—Ä–∞—â–µ–Ω–∏—è
                    // –•–∞–∫ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏ (–¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã JS –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ—Ñ—Å–µ—Ç—ã)
                    // –ù–æ –ª—É—á—à–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–¥–∞—Ç—å –∫–ª–∞—Å—Å—ã
                    el.style.opacity = '1';
                    el.style.transform = 'scale(1)';
                    
                    // –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–π –≤—Ä—É—á–Ω—É—é, —á—Ç–æ–±—ã float —Ä–∞–±–æ—Ç–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
                    if(index === 0) el.style.transform = 'translateX(-100px)';
                    if(index === 2) el.style.transform = 'translateX(100px)';

                    // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è CSS –∞–Ω–∏–º–∞—Ü–∏–∏ float
                    el.style.setProperty('--offset', index === 0 ? '-100px' : (index === 2 ? '100px' : '0px'));
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–∫–∞—á–∏–≤–∞–Ω–∏—è
                    setTimeout(() => el.classList.add('active'), 50 * index);

                    // –ö–ª–∏–∫ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ
                    el.onclick = () => openFinalGift(el);
                });

                statusText.style.opacity = '1';
            }, 800);
        }

        // --- –§–ò–ù–ê–õ ---
        function openFinalGift(element) {
            tg.HapticFeedback.impactOccurred('heavy');
            
            // –í–∑—Ä—ã–≤ —á–∞—Å—Ç–∏—Ü
            const rect = element.getBoundingClientRect();
            createParticles(rect.left + 45, rect.top + 45, 30); // –ú–Ω–æ–≥–æ —á–∞—Å—Ç–∏—Ü

            // –ü—Ä—è—á–µ–º –ø–æ–¥–∞—Ä–∫–∏
            rouletteStage.style.transition = 'opacity 0.2s';
            rouletteStage.style.opacity = '0';
            statusText.style.opacity = '0';
            progressCont.style.opacity = '0';

            setTimeout(() => {
                rouletteStage.style.display = 'none';
                
                // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                resultStage.style.display = 'flex';
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
                setTimeout(() => {
                    resultStage.style.opacity = '1';
                    resultCard.style.transform = 'scale(1)';
                    createConfettiLoop(); // –ó–∞–ø—É—Å–∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Å–∞–ª—é—Ç–∞
                }, 50);
            }, 200);
        }

        // --- –°–ò–°–¢–ï–ú–ê –ß–ê–°–¢–ò–¶ (CANVAS) ---
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        function createParticles(x, y, count) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1,
                    color: `hsl(${Math.random() * 60 + 30}, 100%, 50%)`, // Gold/Yellow shades
                    size: Math.random() * 5 + 2
                });
            }
        }

        function createConfettiLoop() {
            setInterval(() => {
                createParticles(window.innerWidth / 2, window.innerHeight / 2 + 100, 5);
            }, 100);
        }

        function animateParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.02;
                p.size *= 0.95;

                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();

                if (p.life <= 0) {
                    particles.splice(i, 1);
                    i--;
                }
            }
            requestAnimationFrame(animateParticles);
        }
        animateParticles();

    </script>
</body>
</html>
